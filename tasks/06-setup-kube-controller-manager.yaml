---

#- name: "06.1 - template kube-controller-manager Pod manifest"
#  template:
#    src: pod.kube-controller-manager.yaml
#    dest: "{{ __control_plane_manifests_kube_controller_manager_pod_file }}"
#  become: yes
#
#- name: "06.2 - make sure kube-controller-manager Pod is started"
#  k8s:
#    apply: yes
#    kubeconfig: "{{ __control_plane_manifests_admin_user_kubeconfig_file }}"
#    src: "{{ __control_plane_manifests_kube_controller_manager_pod_file }}"
#    state: present
#    wait: yes
#  become: yes

- name: "06.1 - template Kubernetes Controller Manager unit-file"
  template:
    src: kube-controller-manager.tpl.service
    dest: "{{ __control_plane_kube_controller_manager_systemd_unit_file }}"
  become: yes
  notify:
    - control-plane-reload-systemd
    - control-plane-restart-kube-controller-manager-service

- meta: flush_handlers

- name: "05.3 - make sure Kubernetes Controller Manager service is started"
  service:
    name: "{{ __control_plane_kube_controller_manager_service }}"
    state: started
    enabled: yes
  become: yes
